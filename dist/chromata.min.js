!function(t,e){"use strict";var i=function(t,e,i){e&&Object.defineProperties(t,e),i&&Object.defineProperties(t.prototype,i)},n=function(){function t(t){var i,n=this,r=arguments[1]===e?{}:arguments[1],o=document.createElement("canvas"),s=o.getContext("2d"),a=document.createElement("canvas"),u=a.getContext("2d"),l=new Image,c=!1;o.setAttribute("id","chromataCanvas"),this.options=this._mergeOptions(r),l.crossOrigin="Anonymous",l.addEventListener("load",function(){i=h._getOutputDimensions(t,n.options.outputSize),a.width=o.width=i.width,a.height=o.height=i.height,u.drawImage(l,0,0,i.width,i.height),n.dimensions=i,n.imageArray=h._getImageArray(u),n.workingArray=h._getWorkingArray(u),c=!0}),l.src=t.src,this.loader=function(t){c?t():setTimeout(function(){return n.loader(t)},50)},this.imageArray=[],this.sourceImageElement=t,this.sourceContext=u,this.renderContext=s,this.isRunning=!1,this.iterationCount=0}return i(t,null,{start:{value:function(){var t=this;this.loader(function(){t.isRunning=!0,void 0===t._tick?t._run():t._tick()})},writable:!0,enumerable:!0,configurable:!0},stop:{value:function(){return this.isRunning=!1,this.iterationCount},writable:!0,enumerable:!0,configurable:!0},toggle:{value:function(){return this.isRunning?this.stop():this.start()},writable:!0,enumerable:!0,configurable:!0},reset:{value:function(){this.isRunning=!1,this._tick=e,cancelAnimationFrame(this.raf),this.renderContext.clearRect(0,0,this.dimensions.width,this.dimensions.height),this.workingArray=h._getWorkingArray(this.sourceContext),this._removeRenderCanvas()},writable:!0,enumerable:!0,configurable:!0},_mergeOptions:{value:function(t){var e={colorMode:"color",compositeOperation:"lighten",iterationLimit:0,key:"low",lineWidth:2,lineMode:"smooth",origin:["bottom"],outputSize:"original",pathFinderCount:30,speed:7,turningAngle:Math.PI},i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=t[n]||e[n]);return i.origin=i.origin.constructor===Array?i.origin:e.origin,i.pathFinderCount=this._limitToRange(i.pathFinderCount,1,1e4),i.lineWidth=this._limitToRange(i.lineWidth,1,100),i.speed=this._limitToRange(i.speed,1,100),i.turningAngle=this._limitToRange(i.turningAngle,.1,10),i},writable:!0,enumerable:!0,configurable:!0},_limitToRange:{value:function(t,e,i){return Math.min(Math.max(t,e),i)},writable:!0,enumerable:!0,configurable:!0},_appendRenderCanvas:{value:function(){var t=this.sourceImageElement.parentNode;this.sourceImageElement.style.display="none",t.insertBefore(this.renderContext.canvas,this.sourceImageElement.nextSibling)},writable:!0,enumerable:!0,configurable:!0},_removeRenderCanvas:{value:function(){this.sourceImageElement.style.display="",this.renderContext.canvas.parentNode.removeChild(this.renderContext.canvas)},writable:!0,enumerable:!0,configurable:!0},_run:{value:function(){var t=this,e=[],i=this._initPathFinders(),n={colorMode:this.options.colorMode,lineWidth:this.options.lineWidth,lineMode:this.options.lineMode,speed:this.options.speed};this._appendRenderCanvas(),this.renderContext.globalCompositeOperation=this.options.compositeOperation,i.forEach(function(i){e.push(new a(t.renderContext,i,n))}),this._tick=function(){0<t.options.iterationLimit&&t.options.iterationLimit<=t.iterationCount&&(t.isRunning=!1,t.options.iterationLimit=0),e.forEach(function(t){return t.drawNextLine()}),t.iterationCount++,t.isRunning&&(t.raf=requestAnimationFrame(t._tick))},this._tick()},writable:!0,enumerable:!0,configurable:!0},_initPathFinders:{value:function(){var t=this,e=[],i=this.options.pathFinderCount,n=this.options.origin,r=i/n.length,o={speed:this.options.speed,turningAngle:this.options.turningAngle,key:this.options.key};return-1<n.indexOf("bottom")&&this._seedBottom(r,e,o),-1<n.indexOf("top")&&this._seedTop(r,e,o),-1<n.indexOf("left")&&this._seedLeft(r,e,o),-1<n.indexOf("right")&&this._seedRight(r,e,o),n.forEach(function(i){var n=i.match(/(\d{1,3})% (\d{1,3})%/);n&&t._seedPoint(r,e,o,n[1],n[2])}),e},writable:!0,enumerable:!0,configurable:!0},_seedTop:{value:function(t,e,i){var n=this,r=this.dimensions.width/t;i.startingVelocity=[0,this.options.speed],this._seedCreateLoop(t,e,function(t){return r*t-r/2},function(){return n.options.speed},i)},writable:!0,enumerable:!0,configurable:!0},_seedBottom:{value:function(t,e,i){var n=this,r=this.dimensions.width,o=this.dimensions.height,s=r/t;i.startingVelocity=[0,-this.options.speed],this._seedCreateLoop(t,e,function(t){return s*t-s/2},function(){return o-n.options.speed},i)},writable:!0,enumerable:!0,configurable:!0},_seedLeft:{value:function(t,e,i){var n=this,r=this.dimensions.height/t;i.startingVelocity=[this.options.speed,0],this._seedCreateLoop(t,e,function(){return n.options.speed},function(t){return r*t-r/2},i)},writable:!0,enumerable:!0,configurable:!0},_seedRight:{value:function(t,e,i){var n=this,r=this.dimensions.width,o=this.dimensions.height/t;i.startingVelocity=[-this.options.speed,0],this._seedCreateLoop(t,e,function(){return r-n.options.speed},function(t){return o*t-o/2},i)},writable:!0,enumerable:!0,configurable:!0},_seedPoint:{value:function(t,e,i,n,r){for(var s=Math.floor(this.dimensions.width*n/100),a=Math.floor(this.dimensions.height*r/100),u=1;u<t+1;u++){var l=h._indexToRgbString(u);switch(u%4){case 0:i.startingVelocity=[-this.options.speed,0];break;case 1:i.startingVelocity=[0,this.options.speed];break;case 2:i.startingVelocity=[this.options.speed,0];break;case 3:i.startingVelocity=[0,-this.options.speed]}e.push(new o(this.imageArray,this.workingArray,l,s,a,i))}},writable:!0,enumerable:!0,configurable:!0},_seedCreateLoop:{value:function(t,e,i,n,r){for(var s=1;s<t+1;s++){var a=h._indexToRgbString(s),u=i(s),l=n(s);e.push(new o(this.imageArray,this.workingArray,a,u,l,r))}},writable:!0,enumerable:!0,configurable:!0}}),t}();t.Chromata=n;var r=255,o=function(){function t(t,i,n){var o=arguments[3]===e?0:arguments[3],a=arguments[4]===e?0:arguments[4],h=arguments[5]===e?{}:arguments[5];this.pixelArray=t,this.workingArray=i,this.arrayWidth=t[0].length,this.arrayHeight=t.length,this.x=Math.round(o),this.y=Math.round(a),this.options=h,this.pathQueue=new s(10),this.velocity=h.startingVelocity,this.targetColor="string"==typeof n?this._hexToRgb(n):n,this.rgbIndex=this._getRgbIndex(this.targetColor),"low"===this.options.key?this.comparatorFn=function(t,e){return 0<t&&t<e}:this.comparatorFn=function(t,e){return e<t&&t<r}}return i(t,null,{getNextPoint:{value:function(){var t,e=0;do{t=this._getNextPixel(),e++}while(e<=5&&!1===t.isPristine);return t.nextPixel},writable:!0,enumerable:!0,configurable:!0},_getNextPixel:{value:function(){for(var t,e,i,n=this._getVelocityAngle(),o="low"===this.options.key?1e5:0,s=this.options.turningAngle,a=Math.round(Math.sqrt(Math.pow(this.velocity[0],2)+Math.pow(this.velocity[1],2))),h=n-s/2,u=-2;h<=n+s/2;h+=s/4,u++){var l=this.x+Math.round(a*Math.cos(h)),c=this.y+Math.round(a*Math.sin(h)),g=r;if(this._isInRange(l,c)){var d=this.workingArray[c][l][this.rgbIndex],f=this.pixelArray[c][l],b=f[3];g=this._getColorDistance(f),this.comparatorFn(g,o)&&!d&&b===r&&(e=[l,c,r-g],o=g)}if(0===u){var p=this.pixelArray;i=p[c]&&p[c][l]&&p[c][l][3]===r?[l,c,r-g]:this.pathQueue.get(-2)}}return t=void 0!==e,(e=e||i)&&(this.velocity=[e[0]-this.x,e[1]-this.y],this.y=e[1],this.x=e[0],this._updateWorkingArray(e[1],e[0]),this.pathQueue.put(e)),{nextPixel:e,isPristine:t}},writable:!0,enumerable:!0,configurable:!0},getColor:{value:function(){return{r:this.targetColor[0],g:this.targetColor[1],b:this.targetColor[2]}},writable:!0,enumerable:!0,configurable:!0},_getVelocityAngle:{value:function(){var t=this.x+this.velocity[0],e=this.y+this.velocity[1],i=this.options.speed,n=this.y+this.velocity[1]-this.y,r=this.x+this.velocity[0]-this.x;return(t<=i||this.arrayWidth-i<=t)&&(r*=-1),(e<=i||this.arrayHeight-i<=e)&&(n*=-1),Math.atan2(n,r)},writable:!0,enumerable:!0,configurable:!0},_hexToRgb:{value:function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null},writable:!0,enumerable:!0,configurable:!0},_getColorDistance:{value:function(t){return r-t[this.rgbIndex]},writable:!0,enumerable:!0,configurable:!0},_isInRange:{value:function(t,e){return 0<t&&t<this.arrayWidth&&0<e&&e<this.arrayHeight},writable:!0,enumerable:!0,configurable:!0},_updateWorkingArray:{value:function(t,e){this.workingArray[t][e][this.rgbIndex]=!0},writable:!0,enumerable:!0,configurable:!0},_getRgbIndex:{value:function(t){var e;for(e=0;e<2&&0===t[e];e++);return e},writable:!0,enumerable:!0,configurable:!0}}),t}(),s=function(){function t(t){this.queue=[],this.size=t}return i(t,null,{put:{value:function(t){this.queue.push(t),this.size<this.queue.length&&this.queue.shift()},writable:!0,enumerable:!0,configurable:!0},get:{value:function(){var t=arguments[0]===e?0:arguments[0],i=this.queue.length;return 0<=t&&t<=i?this.queue[t]:t<0&&Math.abs(t)<=i?this.queue[i+t]:e},writable:!0,enumerable:!0,configurable:!0},contains:{value:function(t){return 0<this.queue.filter(function(e){return e[0]===t[0]&&e[1]===t[1]}).length},writable:!0,enumerable:!0,configurable:!0}}),t}(),a=function(){function t(t,e,i){this.context=t,this.pathFinder=e,this.options=i,this.color=e.getColor()}return i(t,null,{drawNextLine:{value:function(){"smooth"===this.options.lineMode?this._drawLineSmooth():"square"===this.options.lineMode?this._drawLineSquare():this._drawPoint()},writable:!0,enumerable:!0,configurable:!0},_drawLineSmooth:{value:function(){var t,e,i,n=this.pathFinder.getNextPoint(this.context);if(n){if(void 0===this.currentPoint&&(this.currentPoint=n),void 0===this.controlPoint&&(this.controlPoint=n),t=Math.round((this.controlPoint[0]+n[0])/2),e=Math.round((this.controlPoint[1]+n[1])/2),i=Math.floor((this.currentPoint[2]+n[2])/2),this._getLineLength(this.currentPoint,n)<=3*this.options.speed){var r,o=this.currentPoint[2],s=n[2];r=this._createGradient(this.currentPoint,n,o,s),this.context.strokeStyle=r,this.context.lineWidth=this.options.lineWidth,this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(this.currentPoint[0],this.currentPoint[1]),this.context.quadraticCurveTo(this.controlPoint[0],this.controlPoint[1],t,e),this.context.stroke()}this.currentPoint=[t,e,i],this.controlPoint=n}},writable:!0,enumerable:!0,configurable:!0},_drawLineSquare:{value:function(){var t=this.pathFinder.getNextPoint(this.context);if(t){if(void 0===this.currentPoint&&(this.currentPoint=t),this._getLineLength(this.currentPoint,t)<=this.options.speed+1){var e,i=this.currentPoint[2],n=t[2];e=this._createGradient(this.currentPoint,t,i,n),this.context.strokeStyle=e,this.context.lineWidth=this.options.lineWidth,this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(this.currentPoint[0],this.currentPoint[1]),this.context.lineTo(t[0],t[1]),this.context.stroke()}this.currentPoint=t}},writable:!0,enumerable:!0,configurable:!0},_drawPoint:{value:function(){var t=this.pathFinder.getNextPoint(this.context);t&&(void 0===this.currentPoint&&(this.currentPoint=t),this._getLineLength(this.currentPoint,t)>=2*this.options.speed&&(this.context.beginPath(),this.context.arc(t[0],t[1],this.options.lineWidth,0,2*Math.PI,!1),this.context.fillStyle=this._getStrokeColor(t[2]),this.context.fill(),this.currentPoint=t))},writable:!0,enumerable:!0,configurable:!0},_getLineLength:{value:function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.round(Math.sqrt(i*i+n*n))},writable:!0,enumerable:!0,configurable:!0},_createGradient:{value:function(t,e,i,n){var r=this.context.createLinearGradient(t[0],t[1],e[0],e[1]);return r.addColorStop(0,this._getStrokeColor(i)),r.addColorStop(1,this._getStrokeColor(n)),r},writable:!0,enumerable:!0,configurable:!0},_getStrokeColor:{value:function(t){return"color"===this.options.colorMode?"rgba("+(0!==this.color.r?t:0)+", "+(0!==this.color.g?t:0)+", "+(0!==this.color.b?t:0)+", 1)":"rgba("+t+", "+t+", "+t+", 1)"},writable:!0,enumerable:!0,configurable:!0}}),t}(),h=function(){function t(){}return i(t,{_indexToRgbString:{value:function(t){return t%3==0?"#0000ff":t%2==0?"#00ff00":"#ff0000"},writable:!0,enumerable:!0,configurable:!0},_getImageArray:{value:function(t){for(var e=t.canvas.width,i=t.canvas.height,n=t.getImageData(0,0,e,i),r=[],o=0;o<i;o++){r.push([]);for(var s=0;s<e;s++){for(var a=[],h=o*e*4+4*s,u=0;u<4;u++)a[u]=n.data[h+u];r[o].push(a)}}return r},writable:!0,enumerable:!0,configurable:!0},_getWorkingArray:{value:function(t){for(var e=t.canvas.width,i=t.canvas.height,n=[],r=0;r<i;r++){n.push([]);for(var o=0;o<e;o++)n[r].push([!1,!1,!1])}return n},writable:!0,enumerable:!0,configurable:!0},_getOutputDimensions:{value:function(t,e){var i,n;if("original"===e)i=t.width,n=t.height;else{var r=t.parentNode,o=r.clientWidth/t.width,s=r.clientHeight/t.height,a=s<=o?s:o;i=t.width*a,n=t.height*a}return{width:i,height:n}},writable:!0,enumerable:!0,configurable:!0}}),t}()}(window);
